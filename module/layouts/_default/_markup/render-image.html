<!-- GLOBAL -->
{{- $getlink := .Destination | safeURL -}}
{{- $audioxt := slice ".wav" ".ogg"  ".mp3"  ".avi"  -}}
{{- $imagext := slice ".png" ".webp" ".svg"  ".jpg"  -}}
{{- $videoxt := slice ".mp4" ".flv"  ".webm" ".m3u8" -}}
{{- $pathsrc := "" -}}
{{- $formats := "" -}}
{{- $bcovers := "" -}}


<!-- FORMAT -->
{{ if eq ".lottie" ( path.Ext $getlink )  }}
    {{- $formats =  "anima" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if in $audioxt ( path.Ext $getlink ) }}
    {{- $formats =  "audios" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if in $imagext ( path.Ext $getlink ) }}
    {{- $formats =  "images" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if in $videoxt ( path.Ext $getlink ) }}
    {{- $formats =  "videos" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if eq  ".pdf" ( path.Ext $getlink ) }}
    {{- $formats =  "docus" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if strings.Contains  $getlink "docs.google.com/document" }}
    {{- $formats =  "google-doc" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if strings.Contains  $getlink "docs.google.com/spreadsheets" }}
    {{- $formats =  "google-xls" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ else if strings.Contains  $getlink "docs.google.com/presentation" }}
    {{- $formats =  "google-ppt" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{- else if strings.Contains $getlink "drive.google.com/file" -}}
    {{- $formats =  "google-pdf" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{- else if strings.Contains $getlink "https://w.soundcloud.com/player/" -}}
    {{- $formats =  "google-pdf" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{- else if strings.Contains $getlink "vimeo.com" -}}
    {{- $formats =  "vimeo" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{- else if strings.Contains $getlink "youtube.com" -}}
    {{- $formats =  "youtube" -}}
    {{- $bcovers = "/images/default/audio-player.webp" | absURL  -}}
{{ end }}


<!-- DIRSRC -->
{{ if or ( in $audioxt ( path.Ext $getlink ) ) ( in $imagext ( path.Ext $getlink ) ) ( in $videoxt ( path.Ext $getlink ) ) ( eq ".lottie" ( path.Ext $getlink ) )  }}

    {{- if .Page.Resources.GetMatch $getlink }}

        {{ $pathsrc = .Page.Resources.GetMatch $getlink }}

    {{ else if resources.GetMatch ( print "/" $formats "/" $getlink ) }}

        {{ $pathsrc = resources.GetMatch ( print "/" $formats "/" $getlink ) }}

    {{ else if strings.Contains $getlink "http" }}

        {{ $pathsrc = $getlink }}

    {{ else }}

        {{ $pathsrc = "/icons/no-image.svg" }}
    
    {{ end }}

{{ else if strings.Contains  $getlink "docs.google.com/document" }}

    <!-- google document embed -->
    {{ $pathsrc = print $getlink "?embedded=true" }}

{{ else if strings.Contains  $getlink "docs.google.com/spreadsheets" }}

    <!-- google spreadsheets embed -->
    {{ if strings.Contains $getlink "gid=" }}
        {{ $pathsrc = print $getlink "&widget=true&headers=false" }}
    {{ else }}
        {{ $pathsrc = print $getlink "?widget=true&headers=false" }}
    {{ end }}

{{ else if strings.Contains  $getlink "docs.google.com/presentation" }}

    <!-- google presentation embed link -->
    {{ $pathsrc = replace $getlink "pub?" "embed?" }}

{{- else if strings.Contains $getlink "drive.google.com/file" -}}

     <!-- google pdf embed link -->
     {{ $pathsrc = replace $getlink "/view?usp=share_link" "/preview" }}

{{- else if strings.Contains $getlink "https://w.soundcloud.com/player/" -}}

    {{- $pathsrc =  "google-pdf" -}}

{{- else if strings.Contains $getlink "vimeo.com" -}}

    <!-- vimeo embed link-->
    {{ $pathsrc = $getlink }}

{{- else if strings.Contains $getlink "youtube.com" -}}

    <!-- youtube embed link-->
    {{ $pathsrc = strings.Replace $getlink "watch?v=" "embed/" }}

{{ end }}


<!-- RENDER -->
{{ if and ( $formats ) ( ne $formats "images" ) }} 

{{ $populate := slice ( dict "path_src" $pathsrc "title" .Text "media-type" $formats "cover" $bcovers )  }}

<div class="media portrait grid align-a colfix" data-src="{{ $pathsrc | absURL  }}" data-title="{{ .Text  }}" data-cover="{{ $bcovers }}" data-type="{{ $formats }}" >
    <div class="loader-round"><div></div><div></div></div>
</div>

{{ else if eq $formats "images" }} 

<div class="flex-c">
    {{- $resizer := slice "1972" "1680" "1280" "960" "640" "320" -}}
    {{- $actuals := $pathsrc.Resize "1280x jpg" -}}
    <figure>
        <picture class="media landscape grid align-a colfix" data-src="{{ $pathsrc.RelPermalink }}" data-alt="{{ .Title }}" data-type="images">
            {{ $getwebp := slice }}
            {{ range $resizer }}
                {{ $rezise := "" }}
                {{ $values := "" }}
                {{ if eq . "1972" }}
                    {{ $rezise = $pathsrc.Resize "1972x1109 webp" }}
                    {{ $values  = print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "1680" }}
                    {{ $rezise = $pathsrc.Resize "1680x945 webp" }}
                    {{ $values =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "1280" }}
                    {{ $rezise = $pathsrc.Resize "1280x720 webp" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "960" }}
                    {{ $rezise = $pathsrc.Resize "960x540 webp" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "640" }}
                    {{ $rezise = $pathsrc.Resize "640x360 webp" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "320" }}
                    {{ $rezise = $pathsrc.Resize "320x180 webp" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ end }}
                {{ $getwebp = $getwebp | append $values }} 
            {{ end }}
            {{ $webpsrc := delimit $getwebp ", "  }}
            <source type="image/webp" srcset=" {{- print $webpsrc -}}" />

            {{ $getjpg := slice }}
            {{ range $resizer }}
                {{ $rezise := "" }}
                {{ $values := "" }}
                {{ if eq . "1972" }}
                    {{ $rezise = $pathsrc.Resize "1972x1109 jpg" }}
                    {{ $values  = print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "1680" }}
                    {{ $rezise = $pathsrc.Resize "1680x945 jpg" }}
                    {{ $values =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "1280" }}
                    {{ $rezise = $pathsrc.Resize "1280x720 jpg" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "960" }}
                    {{ $rezise = $pathsrc.Resize "960x540 jpg" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "640" }}
                    {{ $rezise = $pathsrc.Resize "640x360 jpg" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ else if eq . "320" }}
                    {{ $rezise = $pathsrc.Resize "320x180 webp" }}
                    {{ $values   =  print $rezise.RelPermalink " " . "w" }}
                {{ end }}
                {{ $getjpg = $getjpg | append $values }} 
            {{ end }}
            {{ $jpgsrc := delimit $getjpg ", "  }}
            <source type="image/jpg"  srcset="{{- print $jpgsrc -}}" />
            <div class="loader-round"><div></div><div></div></div>
        </picture>
        {{ with .Text }}<p class="fw-600 caption" data-alt="{{ . }}">{{ . }}</p>{{ end }}
    </figure>
</div>

{{ end }}