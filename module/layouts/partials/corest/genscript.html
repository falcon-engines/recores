
<!-- based styles -->
{{- if hugo.IsProduction -}}
    {{- $based_style := slice ( resources.Get "styles/core.scss" ) ( resources.Get "styles/main.scss"  ) | resources.Concat "styles/based.css" | resources.ExecuteAsTemplate "css/base.css" . | toCSS | minify  | fingerprint -}}
    <link id="base-css" type="text/css" rel="stylesheet" href="{{ $based_style.RelPermalink | safeURL }}" />
{{- else -}}
    {{- $based_style := slice ( resources.Get "styles/core.scss" ) ( resources.Get "styles/main.scss" ) | resources.Concat "styles/based.css" | resources.ExecuteAsTemplate "css/base.css" . | toCSS  -}}
    <link id="base-css" type="text/css" rel="stylesheet" href="{{ $based_style.RelPermalink | safeURL }}" />
{{- end -}}


<!-- paged styles -->
{{- if .Scratch.Get "page_css" -}}
    {{- $paged_style := .Scratch.Get "page_css" -}}
    {{ if hugo.IsProduction }}
        {{ range slice $paged_style }}
            {{- $style := resources.Get .src | resources.ExecuteAsTemplate .dest . | toCSS | minify | fingerprint -}}
            <link id="page-css"  type="text/css" rel="stylesheet" href="{{ $style.RelPermalink | safeURL }}" integrity="{{ $style.Data.Integrity | safeHTMLAttr }}"/>
        {{- end -}}
    {{ else }}
        {{ range slice $paged_style }}
            {{- $style := resources.Get .src | resources.ExecuteAsTemplate .dest . | toCSS  -}}
            <link id="page-css"  type="text/css" rel="stylesheet" href="{{ $style.RelPermalink | safeURL }}" />
        {{- end }}
    {{ end }}
{{- end -}}


<!-- google analytic scripts -->
{{ if hugo.IsProduction }}
    {{ template "_internal/google_analytics_async.html" . }}
{{ end }}



<!-- based scripts -->
{{- if hugo.IsProduction -}}
    {{- $based_script := slice ( resources.Get "scripts/core.js" | js.Build "jsx/core.js" ) ( resources.Get "script/main.js" | js.Build "jsx/base.js" ) | resources.Concat "jsx/base.js" | minify | fingerprint  -}}
    <script id="base-jsx" src="{{ $based_script.RelPermalink | safeURL }}" integrity="{{ $based_script.Data.Integrity | safeHTMLAttr }}" type="module" defer></script>
{{- else -}}
    {{- $based_script := slice ( resources.Get "scripts/core.js" | js.Build "jsx/core.js" ) ( resources.Get "script/main.js" | js.Build "jsx/base.js" ) | resources.Concat "jsx/base.js" -}}
    <script id="base-jsx" src="{{ $based_script.RelPermalink | safeURL }}" type="module" defer></script>
{{- end -}}


<!-- paged scripts -->
{{- if .Scratch.Get "page_jsx" -}}
    {{- $paged_script := .Scratch.Get "page_jsx" -}}
    {{- if hugo.IsProduction -}}
        {{- range slice $paged_script -}}
            {{- $page_script := resources.Get .src | js.Build .dest | resources.ExecuteAsTemplate .dest . | minify | fingerprint -}}
            {{- $module_type := cond ( eq .type "module"  ) "module" "" -}}
            <script id="page-jsx" src="{{ $page_script.RelPermalink }}" integrity="{{ $page_script.Data.Integrity | safeHTMLAttr }}" type="{{ $module_type }}" defer></script>
        {{- end -}}
    {{- else -}}
        {{- range slice $paged_script -}}
            {{- $page_script := resources.Get .src | js.Build .dest | resources.ExecuteAsTemplate .dest . -}}
            {{- $module_type := cond ( eq .type "module"  ) "module" "" -}}
            <script id="page-jsx" src="{{ $page_script.RelPermalink }}" type="{{ $module_type }}" defer></script>
        {{- end -}}
    {{- end -}}
{{- end -}}